"use strict";(self.webpackChunkgefyra=self.webpackChunkgefyra||[]).push([[534],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),s=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):u(u({},t),e)),n},c=function(e){var t=s(e.components);return a.createElement(i.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=s(n),m=r,h=p["".concat(i,".").concat(m)]||p[m]||d[m]||o;return n?a.createElement(h,u(u({ref:t},c),{},{components:n})):a.createElement(h,u({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,u=new Array(o);u[0]=m;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l[p]="string"==typeof e?e:r,u[1]=l;for(var s=2;s<o;s++)u[s]=n[s];return a.createElement.apply(null,u)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},8767:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>u,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var a=n(7462),r=(n(7294),n(3905));const o={layout:"page",title:"Run a Ubuntu container instance",permalink:"/usecases/ubuntu-in-namespace/",nav_order:1,parent:"Use Cases and Demos"},u="Making any container part of your Kubernetes namespace",l={unversionedId:"usecases/ubuntu-in-namespace",id:"usecases/ubuntu-in-namespace",title:"Run a Ubuntu container instance",description:"Simple Usecase",source:"@site/docs/usecases/ubuntu-in-namespace.md",sourceDirName:"usecases",slug:"/usecases/ubuntu-in-namespace",permalink:"/docs/usecases/ubuntu-in-namespace",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/usecases/ubuntu-in-namespace.md",tags:[],version:"current",frontMatter:{layout:"page",title:"Run a Ubuntu container instance",permalink:"/usecases/ubuntu-in-namespace/",nav_order:1,parent:"Use Cases and Demos"},sidebar:"docsSidebar",previous:{title:"Use Cases and Demos",permalink:"/docs/usecases/"},next:{title:"OAuth2 Demo with a Sidecar",permalink:"/docs/usecases/oauth2-demo"}},i={},s=[{value:"What you will learn",id:"what-you-will-learn",level:3},{value:"What you will need",id:"what-you-will-need",level:3},{value:"Table of contents",id:"table-of-contents",level:3},{value:"Creating the local development infrastructure",id:"creating-the-local-development-infrastructure",level:2},{value:"Getting the App Running",id:"getting-the-app-running",level:2},{value:"Connecting Gefyra to the Kubernetes cluster",id:"connecting-gefyra-to-the-kubernetes-cluster",level:2},{value:"Running a container in a Kubernetes namespace",id:"running-a-container-in-a-kubernetes-namespace",level:2},{value:"Enter the container and call a service",id:"enter-the-container-and-call-a-service",level:3},{value:"Remove the Ubuntu container",id:"remove-the-ubuntu-container",level:3},{value:"Remove the Development Infrastructure",id:"remove-the-development-infrastructure",level:2},{value:"Additional Notes",id:"additional-notes",level:2}],c={toc:s},p="wrapper";function d(e){let{components:t,...n}=e;return(0,r.kt)(p,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"making-any-container-part-of-your-kubernetes-namespace"},"Making any container part of your Kubernetes namespace"),(0,r.kt)("p",null,"Simple Usecase"),(0,r.kt)("p",null,"This example demonstrates how to run a local Ubuntu container instance as part of your Kubernetes namespace. "),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"what-you-will-learn"},"What you will learn"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Run a Ubuntu container as part of a Kubernetes namespace"),(0,r.kt)("li",{parentName:"ul"},"Install additional software to that instance"),(0,r.kt)("li",{parentName:"ul"},"Use this container to call Kubernetes services")),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"what-you-will-need"},"What you will need"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/installation"},"Gefyra")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/Schille/getdeck"},"Getdeck")," for setting up the development infrastructure (runs on ",(0,r.kt)("inlineCode",{parentName:"li"},"k3d"),")"),(0,r.kt)("li",{parentName:"ul"},"kubectl"),(0,r.kt)("li",{parentName:"ul"},"Optionally: ",(0,r.kt)("a",{parentName:"li",href:"https://k3d.io"},"k3d")," or any other preferred Kubernetes cluster")),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"table-of-contents"},"Table of contents"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"TOC")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"creating-the-local-development-infrastructure"},"Creating the local development infrastructure"),(0,r.kt)("p",null,"First, we need a Kubernetes-based development infrastructure which contains all required components. Luckily this can\nbe achieved quite easily with the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/Getdeck/getdeck"},(0,r.kt)("inlineCode",{parentName:"a"},"Deck CLI")," from here"),"."),(0,r.kt)("p",null,"Just run: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"deck get https://github.com/Blueshoe/buzzword-charts.git\n")),(0,r.kt)("p",null,"and you will get a fresh ",(0,r.kt)("inlineCode",{parentName:"p"},"k3d")," cluster running locally with all required components installed. "),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Important:")," These workloads are intended for demonstration purposes and are not safe for production deployments."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Optional:")," If you don't want to create the development infrastructure using ",(0,r.kt)("inlineCode",{parentName:"p"},"Getdeck")," you can also provide it\nyourself. You need:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"a Kubernetes cluster"),(0,r.kt)("li",{parentName:"ul"},"some workload, you can choose the example\nfrom ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/Blueshoe/buzzword-charts/tree/main/buzzword-counter"},"here")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"helm install")," it yourself"),(0,r.kt)("li",{parentName:"ul"},"a node port at 31820:31820/UDP (if running it locally)")),(0,r.kt)("h2",{id:"getting-the-app-running"},"Getting the App Running"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Optional:")," In order to observe the workload booting up, check out\n",(0,r.kt)("a",{parentName:"p",href:"http://dashboard.127.0.0.1.nip.io:8080/#/workloads?namespace=buzzword"},"the Kubernetes dashboard")," coming with this ",(0,r.kt)("inlineCode",{parentName:"p"},"deck"),"."),(0,r.kt)("h2",{id:"connecting-gefyra-to-the-kubernetes-cluster"},"Connecting Gefyra to the Kubernetes cluster"),(0,r.kt)("p",null,"The first would be to spin up Gefyra with ",(0,r.kt)("inlineCode",{parentName:"p"},"gefyra up"),". Please be sure to still have the development cluster\nactive in your current ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl")," context. "),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Important:")," If you are running a remote Kubernetes cluster you need to specify the ",(0,r.kt)("inlineCode",{parentName:"p"},"--host")," argument with ",(0,r.kt)("em",{parentName:"p"},"IP"),"\nof one of your data plane nodes. The default port is ",(0,r.kt)("em",{parentName:"p"},"31820")," (",(0,r.kt)("inlineCode",{parentName:"p"},"--port"),"), it may be different depending on firewalls and the cluster\nnetworking."),(0,r.kt)("h2",{id:"running-a-container-in-a-kubernetes-namespace"},"Running a container in a Kubernetes namespace"),(0,r.kt)("p",null,"In this example, a Ubuntu will become part of the cluster namespace ",(0,r.kt)("em",{parentName:"p"},"buzzword"),".\nStart the container instance like so :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$> gefyra run -i ubuntu -N myubuntu -n buzzword -c \"bash -c 'tail -f /dev/null'\"\n> [INFO] Container image 'ubuntu:latest' started with name 'myubuntu' in Kubernetes namespace 'buzzword'\n")),(0,r.kt)("p",null,"No worries, the following explains the parameter list:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"-i ubuntu"),": run the public Docker image ob Ubuntu from here: ",(0,r.kt)("a",{parentName:"li",href:"https://hub.docker.com/_/ubuntu"},"https://hub.docker.com/_/ubuntu")," "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"-N myubuntu"),": name this local Docker instance ",(0,r.kt)("em",{parentName:"li"},"myubuntu")," for further reference"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"-n buzzword"),": place this Docker instance in the Kubernetes namespace ",(0,r.kt)("em",{parentName:"li"},"buzzword")," (where this example plays)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"-c \"bash -c 'tail -f /dev/null'\""),": start this Docker instance and keep it running forever")),(0,r.kt)("p",null,"You can check the output of ",(0,r.kt)("inlineCode",{parentName:"p"},"docker ps")," to see your container instance running. It should look something like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'CONTAINER ID   IMAGE                         COMMAND                  CREATED          STATUS          PORTS                                                            NAMES\n660ce52ce4e1   ubuntu                        "bash -c \'tail -f /d\u2026"   9 seconds ago    Up 8 seconds                                                                     myubunut\ne0add97dee80   gefyra-cargo:20220426153151   "/init"                  14 seconds ago   Up 13 seconds                                                                    gefyra-cargo\n97f9908c55df   rancher/k3d-proxy:4.4.8       "/bin/sh -c nginx-pr\u2026"   12 minutes ago   Up 12 minutes   0.0.0.0:8080->80/tcp, :::8080->80/tcp, 0.0.0.0:34089->6443/tcp   k3d-another-cluster-serverlb\n1dccf93fc087   rancher/k3s:v1.20.4-k3s1      "/bin/k3s agent"         12 minutes ago   Up 12 minutes   0.0.0.0:31820->31820/udp, :::31820->31820/udp                    k3d-another-cluster-agent-0\n91ef49d000b5   rancher/k3s:v1.20.4-k3s1      "/bin/k3s server --t\u2026"   12 minutes ago   Up 12 minutes                                                                    k3d-another-cluster-server-0\n')),(0,r.kt)("h3",{id:"enter-the-container-and-call-a-service"},"Enter the container and call a service"),(0,r.kt)("p",null,"Now that the container is running, you can enter a bash by running: ",(0,r.kt)("inlineCode",{parentName:"p"},"docker exec -it myubuntu bash")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"root@6178770cd6b1:/#\n")),(0,r.kt)("p",null,"In order to call an http service from this Kubernetes namespace a terminal application could be handy. The official\nUbuntu Docker image does not provide on of my favorites out of the box, but it is easy to add it."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"root@6178770cd6b1:/# apt update && apt install wget -y\n[...]\n")),(0,r.kt)("p",null,"On another terminal (so not in your Ubuntu bash) you can consult ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl")," to inspect the services in the ",(0,r.kt)("em",{parentName:"p"},"buzzword")," namespace. For this example it\ntells:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$> kubectl -n buzzword get services\nNAME                                   TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                                 AGE\ndashboard-kubernetes-dashboard         ClusterIP   10.43.147.1     <none>        8080/TCP                                18m\n[...]\nbuzzword-counter                       ClusterIP   10.43.221.222   <none>        9000/TCP                                18m\nbuzzword-counter-postgresql            ClusterIP   10.43.140.176   <none>        5432/TCP                                18m\nbuzzword-counter-postgresql-headless   ClusterIP   None            <none>        5432/TCP                                18m\nbuzzword-counter-rabbitmq              ClusterIP   10.43.0.48      <none>        4369/TCP,5672/TCP,25672/TCP,15672/TCP   18m\nbuzzword-counter-rabbitmq-headless     ClusterIP   None            <none>        4369/TCP,5672/TCP,25672/TCP,15672/TCP   18m\n")),(0,r.kt)("p",null,"Let's see how this works. From within your running Ubuntu bash, you can now call the ",(0,r.kt)("em",{parentName:"p"},"buzzword-counter")," service on port\n9000:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'root@6178770cd6b1:/# wget -O- buzzword-counter:9000\n--2022-04-26 13:41:43--  http://buzzword-counter:9000/\nResolving buzzword-counter (buzzword-counter)... 10.43.221.222\nConnecting to buzzword-counter (buzzword-counter)|10.43.221.222|:9000... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 565 [text/html]\nSaving to: \'STDOUT\'\n\n-                                                0%[                                                                                                   ]       0  --.-KB/s               <h1>Buzzwords</h1>\n<form action="/increase-counter/" method="post">\n    <input type="hidden" name="csrfmiddlewaretoken" value="HrGPa8q6GyjVi5ZeHsf4noTFZoOpxA78OmpOEe8cWut8uyeuVxyZ8wPLN0e3QISM">\n    <table>\n        <tr>\n            <th>Buzzword</th>\n            <th>Count</th>\n            <th>Increase</th>\n            <th>Decrease</th>\n        </tr>\n    \n    </table>\n    <div>\n        <label for="new_buzzword">New Buzzword:</label>\n        <input type="text" id="new_buzzword" name="new_buzzword">\n        <button type="submit">Submit</button>\n    </div>\n</form>\n-                                              100%[==================================================================================================>]     565  --.-KB/s    in 0s      \n\n2022-04-26 13:41:43 (18.9 MB/s) - written to stdout [565/565]\n')),(0,r.kt)("p",null,"Et voila! The service responded to the HTTP Get request with the same answer you would get with your browser at:\n",(0,r.kt)("a",{parentName:"p",href:"http://buzzword-counter.127.0.0.1.nip.io:8080"},"http://buzzword-counter.127.0.0.1.nip.io:8080"),".\nYou can now look around and make yourself familiar with the services\nin this namespace - or even connect with the ",(0,r.kt)("inlineCode",{parentName:"p"},"psql")," client to the ",(0,r.kt)("em",{parentName:"p"},"PostgreSQL")," instance running in the cluster."),(0,r.kt)("h3",{id:"remove-the-ubuntu-container"},"Remove the Ubuntu container"),(0,r.kt)("p",null,"Once you are done with your work, you can remove this Ubuntu instance again with:\n",(0,r.kt)("inlineCode",{parentName:"p"},"docker kill myubuntu"),". That's it."),(0,r.kt)("h2",{id:"remove-the-development-infrastructure"},"Remove the Development Infrastructure"),(0,r.kt)("p",null,"First run ",(0,r.kt)("inlineCode",{parentName:"p"},"gefyra down")," to uninstall Gefyra's components. If you have initially created the development infrastructure using ",(0,r.kt)("inlineCode",{parentName:"p"},"Getdeck")," you can now run:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$> deck remove --cluster https://github.com/Blueshoe/buzzword-charts.git\n[INFO] Deleting the k3d cluster with name another-cluster\n")),(0,r.kt)("p",null,"If you created the infrastructure yourself, you probably already know how to get rid of everything yourself ;-)"),(0,r.kt)("h2",{id:"additional-notes"},"Additional Notes"),(0,r.kt)("p",null,"If you want maximum convenience for your developers and a supported team oriented workflow, we recommend you\ncheck out ",(0,r.kt)("a",{parentName:"p",href:"https://unikube.io"},"Unikube"),".\nGefyra is part of Unikube's development workflow."))}d.isMDXComponent=!0}}]);