"use strict";(self.webpackChunkgefyra=self.webpackChunkgefyra||[]).push([[7831],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=a.createContext({}),s=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(c.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},f=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,c=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),p=s(n),f=i,m=p["".concat(c,".").concat(f)]||p[f]||u[f]||r;return n?a.createElement(m,l(l({ref:t},d),{},{components:n})):a.createElement(m,l({ref:t},d))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,l=new Array(r);l[0]=f;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o[p]="string"==typeof e?e:i,l[1]=o;for(var s=2;s<r;s++)l[s]=n[s];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}f.displayName="MDXCreateElement"},7590:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>o,toc:()=>s});var a=n(7462),i=(n(7294),n(3905));const r={title:"Managing Gefyra Clients",sidebar_position:2},l="Working With Gefyra Clients",o={unversionedId:"shared-environments/clients",id:"version-2.0.0/shared-environments/clients",title:"Managing Gefyra Clients",description:"Gefyra Clients provide a way to grant multiple clients (i.e. users, robots, pipelines, etc.) limited access to a Kubernetes cluster in order to use Gefyra's capabilities. They are managed with gefyra clients [COMMAND].",source:"@site/versioned_docs/version-2.0.0/shared-environments/clients.md",sourceDirName:"shared-environments",slug:"/shared-environments/clients",permalink:"/docs/shared-environments/clients",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/versioned_docs/version-2.0.0/shared-environments/clients.md",tags:[],version:"2.0.0",sidebarPosition:2,frontMatter:{title:"Managing Gefyra Clients",sidebar_position:2},sidebar:"docsSidebar",previous:{title:"Installing Gefyra in a Cluster",permalink:"/docs/shared-environments/installation"},next:{title:"Connecting to Gefyra",permalink:"/docs/shared-environments/connecting"}},c={},s=[{value:"Shared Cluster Access",id:"shared-cluster-access",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Creating a Gefyra Client",id:"creating-a-gefyra-client",level:2},{value:"Retrieving a <em>Client File</em>",id:"retrieving-a-client-file",level:2},{value:"A Default Client File",id:"a-default-client-file",level:3},{value:"Providing Custom Connection Data",id:"providing-custom-connection-data",level:3},{value:"Distributing the Client File",id:"distributing-the-client-file",level:3},{value:"Deleting a Gefyra Client",id:"deleting-a-gefyra-client",level:2}],d={toc:s},p="wrapper";function u(e){let{components:t,...n}=e;return(0,i.kt)(p,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"working-with-gefyra-clients"},"Working With Gefyra Clients"),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("mdxAdmonitionTitle",{parentName:"admonition"},(0,i.kt)("strong",{parentName:"mdxAdmonitionTitle"},"TLDR;")),(0,i.kt)("p",{parentName:"admonition"},"Gefyra Clients provide a way to grant multiple clients (i.e. users, robots, pipelines, etc.) limited access to a Kubernetes cluster in order to use Gefyra's capabilities. They are managed with ",(0,i.kt)("a",{parentName:"p",href:"/docs/cli#clients"},(0,i.kt)("inlineCode",{parentName:"a"},"gefyra clients [COMMAND]")),".")),(0,i.kt)("p",null,"Gefyra introduces the concept of ",(0,i.kt)("strong",{parentName:"p"},"Gefyra Clients"),". These are objects to manage and distribute access to the cluster.  "),(0,i.kt)("h2",{id:"shared-cluster-access"},"Shared Cluster Access"),(0,i.kt)("p",null,"Each created client object get a dedicated ",(0,i.kt)("em",{parentName:"p"},"Kubernetes Service Account")," attached that is being used by any Gefyra client during its interaction with the cluster. The corresponding ",(0,i.kt)("em",{parentName:"p"},"client file"),", which contains the connection parameters for the ",(0,i.kt)("em",{parentName:"p"},"Service Account")," can be retrieved from the cluster by the administrator with Gefyra's CLI.  "),(0,i.kt)("p",null,"This client file can be then distributed to anyone which needs to ",(0,i.kt)("inlineCode",{parentName:"p"},"connect"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"run")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"bridge")," workloads in the given cluster.\nThe permissions of the Kubernetes service account are limited, following the principle of the least privilege. Hence, Gefyra clients can only operate in the cluster with the well-defined set Gefyra's actions."),(0,i.kt)("p",null,"This flow gives a brief overview of Gefyra's workflow for teams:"),(0,i.kt)("mermaid",{value:'flowchart TD;\n    install["DevOps installs Gefyra (<a href=\'/docs/cli#install\'>gefyra install</a>)"]\n    generate["DevOps generates Gefyra client (<a href=\'/docs/cli#clients\'>gefyra clients create</a>)"]\n    save["DevOps saves Gefyra client files (<a href=\'/docs/cli#clients-config\'>gefyra clients config</a>)"]\n    distribute["DevOps distributes client file"]\n    connect["Developer connects via client file (<a href=\'/docs/cli#connections\'>gefyra connections</a>)"]\n    run["Developer runs workload (<a href=\'/docs/cli#run\'>gefyra run</a>)"]\n    install--\x3egenerate\n    generate--\x3esave\n    save--\x3edistribute\n    distribute--\x3econnect\n    connect--\x3erun'}),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Important:")," Although clients may be shared by multiple machines, it is neither recommended not will it work simultaneously.\nOnce a client connects to a cluster, it agrees with Gefyra's Operator on a dedicated IP-range that no other client can use at the same time. Clients may ",(0,i.kt)("em",{parentName:"p"},"connect")," and ",(0,i.kt)("em",{parentName:"p"},"disconnect")," at any time. When disconnecting from the cluster, clients release their VPN peer (and thus their IP-range) association."),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Gefyra is ",(0,i.kt)("a",{parentName:"li",href:"https://gefyra.dev/installation"},"available")," (at least in version 2.0.0)  "),(0,i.kt)("li",{parentName:"ol"},"Gefyra is ",(0,i.kt)("a",{parentName:"li",href:"./installation"},"installed")," to a shared Kubernetes cluster"),(0,i.kt)("li",{parentName:"ol"},"Admin access to the shared cluster")),(0,i.kt)("h2",{id:"creating-a-gefyra-client"},"Creating a Gefyra Client"),(0,i.kt)("p",null,"You can create as many clients as you need in a cluster. Every client will have it's very own VPN connection to the cluster.",(0,i.kt)("br",{parentName:"p"}),"\n","An admin manages clients via Gefyra's ",(0,i.kt)("inlineCode",{parentName:"p"},"gefyra client")," command group in the CLI. Gefyra operates with the currently active cluster context on the machine it is running on."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Remark:")," Check your active cluster context with ",(0,i.kt)("inlineCode",{parentName:"p"},"kubectl config current-context"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"> gefyra client\n\nManage clients for a Gefyra installation\n\nCommands:\n  config (write)      Get a Gefyra connection config for a client\n  create              Create a new Gefyra client\n  delete (rm,remove)  Mark a Gefyra client for deletion\n  inspect (show,get)  Discribe a Gefyra client\n  list (ls)           List all Gefyra clients\n\n")),(0,i.kt)("p",null,"You can create one client object with:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"> gefyra clients create\n\n1 client(s) created successfully\n")),(0,i.kt)("p",null,"That command created a randomly named client in your cluster. You can find it with:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"> gefyra clients ls\nID                                STATE                        CREATED\n20d50da476524eaf8dd511deed55fc63  GefyraClientState.REQUESTED  Creating...\n")),(0,i.kt)("p",null,"Once the client is ready, you will find the following output:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"> gefyra clients ls\nID                                STATE                      CREATED\n20d50da476524eaf8dd511deed55fc63  GefyraClientState.WAITING  2023-10-06T15:21:19.771717Z\n")),(0,i.kt)("p",null,"The client is now in the waiting state and ready for connection."),(0,i.kt)("p",null,"To manage human-readable clients, you can set the client name with:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"gefyra clients create --client-id my-fancy-client\n")),(0,i.kt)("p",null,"or create many clients at once using:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"gefyra clients create -n 10\n")),(0,i.kt)("p",null,"This will create a set of 10 clients in the cluster."),(0,i.kt)("h2",{id:"retrieving-a-client-file"},"Retrieving a ",(0,i.kt)("em",{parentName:"h2"},"Client File")),(0,i.kt)("p",null,"Gefyra clients require a client file to connect to this cluster. The admin is responsible to fetch these client files and\ndistribute them to other machines, developers, etc."),(0,i.kt)("h3",{id:"a-default-client-file"},"A Default Client File"),(0,i.kt)("p",null,"The following command prints the client file of the selected client to the console:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'> gefyra clients config 20d50da476524eaf8dd511deed55fc63\n\n{"client_id": "20d50da476524eaf8dd511deed55fc63", "kubernetes_server": "https://<redacted>", "provider": "stowaway", "token": "<redacted>", "namespace": "<redacted>", "ca_crt": "<redacted>", "gefyra_server": "<redacted>:31820"}\n')),(0,i.kt)("p",null,"As you can see, the ",(0,i.kt)("em",{parentName:"p"},"client file")," is JSON-structured and contains a lot of secret information. Especially the\n",(0,i.kt)("em",{parentName:"p"},"access token")," of the Kubernetes service account that is associated with this Gefyra client, but also the other connection\nparameters are ",(0,i.kt)("strong",{parentName:"p"},"highly sensible"),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Important:")," Please handle the ",(0,i.kt)("em",{parentName:"p"},"client files")," with care as they contain confidential information. Leaking these files may\nallow unidentified individuals access to your Gefyra cluster."),(0,i.kt)("p",null,"You can either pipe that output to a file on your local machine:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"gefyra clients config 20d50da476524eaf8dd511deed55fc63 > 20d50da476524eaf8dd511deed55fc63.json\n")),(0,i.kt)("p",null,"or use the ",(0,i.kt)("em",{parentName:"p"},"output flag")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"gefyra clients config 20d50da476524eaf8dd511deed55fc63 -o 20d50da476524eaf8dd511deed55fc63.json\n")),(0,i.kt)("p",null,"in your current working directory."),(0,i.kt)("h3",{id:"providing-custom-connection-data"},"Providing Custom Connection Data"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Important:")," In this process, Gefyra tries to determine as many connection parameters as possible automatically. However,\nif there are network-related customizations to made for your client, please provide them at this point."),(0,i.kt)("p",null,"If you need to specify the connection endpoint for Kubernetes differently, please use the ",(0,i.kt)("inlineCode",{parentName:"p"},"--kubernetes-api")," option, e.g."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'gefyra clients config 20d50da476524eaf8dd511deed55fc63 -o 20d50da476524eaf8dd511deed55fc63.json --kubernetes-api "https://k8s.blueshoe.io"\n')),(0,i.kt)("p",null,"If you need to specify Gefyra's VPN connection endpoint, please use the ",(0,i.kt)("inlineCode",{parentName:"p"},"--host")," and/or ",(0,i.kt)("inlineCode",{parentName:"p"},"--port")," option, e.g."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"gefyra clients config 20d50da476524eaf8dd511deed55fc63 --host 192.169.0.1\n")),(0,i.kt)("p",null,"This data will be written into the ",(0,i.kt)("em",{parentName:"p"},"client file")," so that your clients can connect to the cluster using these parameters. If you\nfail to provide correct data to your clients, they might be unable to connect to the cluster. "),(0,i.kt)("h3",{id:"distributing-the-client-file"},"Distributing the Client File"),(0,i.kt)("p",null,"This ",(0,i.kt)("em",{parentName:"p"},"client file")," is all a Gefyra client needs in order to establish a connection. Of course, you are free to distribute these files any way you want, but please keep in mind the security implications."),(0,i.kt)("h2",{id:"deleting-a-gefyra-client"},"Deleting a Gefyra Client"),(0,i.kt)("p",null,"You can delete a Gefyra client in every stage of its lifecycle. This will disconnect the client (forcefully) and render its\n",(0,i.kt)("em",{parentName:"p"},"client file")," invalid to that the owner of the file will no longer be able to connect to the cluster."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"> gefyra clients delete 20d50da476524eaf8dd511deed55fc63\nClient 20d50da476524eaf8dd511deed55fc63 marked for deletion\n")),(0,i.kt)("p",null,"When you delete a Gefyra client, its credentials are also irretrievably deleted."))}u.isMDXComponent=!0}}]);